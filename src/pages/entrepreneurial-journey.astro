---
import MarkdownIt from 'markdown-it';
import BaseLayout from '../layouts/BaseLayout.astro';

const md = new MarkdownIt({ breaks: true, linkify: true });

async function getGistContent(): Promise<string> {
  try {
    const response = await fetch('https://api.github.com/gists/0b5ddf35e6d70d118c86f10c3d7801bf');
    if (!response.ok) {
      return '';
    }

    const data = await response.json();
    const rawContent = data?.files?.['entrepreneurial-journey.md']?.content ?? '';

    return rawContent.replace(/---\ngists:[^>]+true\n---/g, '');
  } catch {
    return '';
  }
}

const gistContent = await getGistContent();
const content = md.render(gistContent);
---

<BaseLayout
  title="my entrepreneurial journey"
  description="My journey through entrepreneurship."
  canonicalPath="/entrepreneurial-journey"
>
  <section>
    <h1 class="font-bold text-2xl mb-8">my entrepreneurial journey</h1>
    <div class="prose prose-neutral mb-8 dark:prose-invert"></div>
    <div class="prose log prose-neutral mb-8 dark:prose-invert">
      {gistContent ? <div set:html={content} /> : <p>Content not available right now.</p>}
    </div>
  </section>
</BaseLayout>
